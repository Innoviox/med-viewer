medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                 FORECASTING COMBINATION OF HIERARCHICAL TIME SERIES: A
                           NOVEL METHOD WITH AN APPLICATION TO COVID-19
                                                                B Y L IVIO F ENGA1
                                           1 Italian National Institute of Statistics (ISTAT), livio.fenga@istat.it
                                     Multiple, hierarchically organized time series are routinely submitted to
                                 the forecaster upon request to provide estimates of their future values, re-
                                 gardless the level occupied in the hierarchy. In this paper, a novel method for
                                 the prediction of hierarchically structured time series will be presented. The
                                 idea is to enhance the quality of the predictions obtained using a technique
                                 of the type forecast reconciliation, by applying this procedure to a set of op-
                                 timally combined predictions, generated by different statistical models. The
                                 goodness of the proposed method will be evaluated using the official time
                                 series related to the number of people tested positive to the SARS-CoV-2 in
                                 each of the Italian regions, between February 24th 2020 and August 31th
                                 2020.
                1. Introduction. In many applications, it is often the case that accurate forecasts are
            needed for time series showing an inherent hierarchical structure. For example, in economics
            the forecaster is routinely asked to provide separate forecasts for the industrial production
            index at the most aggregated level as well as for specific (sub–) classes of economic activi-
            ties. The estimation of the future demand of domestic tourism usually follows a geographical
            proximity criterion, based on which the related time series are organized (and predicted) ac-
            cording to homogeneous groups. Sometimes, emergency situations require close monitoring
            of the spread of a disease not only at a national but also at a regional level, e.g. in order to
            set up more appropriate countermeasures for elderly and chronically ill people. These are
            all cases where a single line of hierarchy generates the overall structure of the data which
            therefore is referred to as “hierarchical time series”. The present paper is concerned with
            the forecast of such data structures. While on one hand it is always possible to disregard the
            underlying hierarchical arrangement and thus carry out the prediction exercise considering
            each time series singularly, on the other hand, by doing so, it is very unlikely for the result-
            ing higher level forecasts to be equal to the sum of the lower level ones. It goes by itself
            that such a situation is not acceptable in many instances, e.g. in the field of official statistics
            where aggregation consistency is generally a conditio sine qua non and even slight misalign-
            ment need to be dealt with. Therefore, many combination techniques have been designed to
            preserve the needed adding-up conditions, by accounting for the position occupied in the hi-
            erarchy by each and every time series, regardless their level of (dis–)aggregation. However,
            this type of approach – usually referred to as forecast reconciliation – is in general dependent
            on the statistical model a priori chosen to carry out the forecasting exercise. Undoubtedly,
            this choice might negatively impact the quality of the generated forecasts, e.g. by conveying
            not negligible amount of uncertainty into the analysis. This is especially true in the case of
            real-life data – where problems, such as small sample size, noise and systematic and/or non
            systematic errors – might hinder the choice of the “right” statistical model.
                Motivated by this, in the present paper a method built upon the forecast reconciliation
            procedure devised by Hyndman, R. J., Ahmed, R. A., Athanasopoulos, G., and Shang, H.
                Keywords and phrases: ARIMA model, ARFIMA model, Exponential Smoothing model, forecast reconcilia-
            tion, forecast combination, model uncertainty, SARS-CoV-2, Theta method
                                                                               1
       NOTE: This preprint reports new research that has not been certified by peer review and should not be used to guide clinical practice.

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
            2
            L. (2011) will be presented. In more details, it will be formulated a joint hierarchical fore-
            casting system, where an additional optimality condition, derived in a multi-model setup of
            the type forecast combination, drives the choice of the “best” statistical model generating the
            predicted values. A final step, designed to lower the bias of the selected forecasts, is also part
            of the procedure. The main novelty of the method is that the forecast combination is applied
            directly on forecasts which have already been reconciled. In essence, it is an optimization
            procedure articulated in four steps: one performed at a cross-section level (reconciliation),
            two at a cross-model level (forecast combination) and the final one on the chosen prediction
            vector, for bias adjustment purposes. Surprisingly, to the best of the author’s knowledge, this
            is the first attempt of this sort in the case of cross-sectional hierarchical time series.
                The rest of the paper is structured as follows: Section 2 is devoted to the literature review
            concerning the two statistical methods the proposed procedure is based on, which will be
            detailed in the following Section 3. The proposed method, as well as its justification, will
            be respectively illustrated in Section 4 and 5. The following Section 6 will be devoted to
            an extensive empirical application, carried out using the official Italian data related to the
            SARS-CoV-2 positive cases, which will demonstrate the validity of the proposed approach.
            Section ??, containing the conclusions and the future directions of this work, will end the
            paper.
                2. Literature review. As already mentioned, the proposed procedure is based on two
            class of methods, usually referred to as forecast reconciliation and forecast combination. The
            former serves the purpose of achieving aggregation consistency of individual, aggregation
            inconsistent, forecasts whereas the latter will be employed to combine different reconciled
            forecasts, each of them generated according to different statistical models.
                A rigorous and theoretically sound investigation on forecasts combination dates back to
            the late 60s – with the famous seminal paper by Bates, J. M., and Granger, C. W. (1969).
            Here, the Authors showed that the combination of forecasts often leads to a better forecast
            accuracy and, by doing so, provided an alternative way to the notion that a “best” method
            exists and can be identified. Ever since this paper, the integration of a number of forecasts,
            independently estimated on a single time series, has attracted a great deal of research interest
            and, as a result, a vast literature is today available. Much of it is aimed at presenting empir-
            ical applications documenting the appealing features of this approach, which in many cases
            can improve even upon the best individual forecast, in terms of forecast risk, forecast error
            variance and consistency between in-sample and out-of-sample error distributions, as pointed
            out by Barrow, D. K., and Kourentzes, N. (2016). This can happen for a variety of reasons,
            many of them related to the fact that the choice of the “right” model, in general, implies the
            injection of not negligible amounts of uncertainty into the analysis (Chambers, J. C., Mullick,
            S. K., and Smith, D. D. (1971) and Chatfield, C. (1996). In the same line of thinking, many
            Authors, see for example Makridakis, S. (1989), Stock, J. H., and Watson, M. W (2001) and
             Stock, J. H., and Watson, M. W. (2004), emphasize the dangers related to misspecification
            errors, which, on the other hand, can be mitigated by combining the forecasts yielded by a
            number of models. In support of this argument, there are a number of studies where it is
            shown that it is very unlikely, using a well calibrated portfolio of models, that one of them
            consistently dominates the others across the whole prediction window. Such an argument is
            consistent with the view that the “true” underlying data generating process is, saved for trivial
            or lab controlled cases, way too complicated to be adequately captured by a single model.
            This is the position, for example, of Buckland, S. T., Burnham, K. P., and Augustin, N. H.
            (1997), according to whom the data can never support, and we can never identify, the “true”

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                FOREASTING HIERARCHICAL TIME SERIES                                         3
            model. Therefore, the selection of a statistical model is more realistically the process of iden-
            tifying the best approximating one. Once defined models as approximations, the concept of
            the identification of the “true” one ceases to be decisive in favor of approaches pursuing, in
            the first place, the goal of achieving good forecasting performances.
                Many practical uses of forecasts combination are discussed in the excellent work of
            Clemen, R. T. (1989), where the Author covers a wide spectrum of applications, ranging
            from economics, demography and politics to meteorology and outcomes of football games.
            In the same spirit is the more recent paper by Mancuso, A. C. B., and Werner, L. (2013),
            which presents a classification of 174 articles focusing on forecast combination. In particular,
            new applications are reported from different sectors, such as commercial, tourism, urban traf-
            fic, betting market and propagation of successful innovations. The analysis of the outcomes
            of the M3 forecast competition, discussed in Makridakis, S., and Hibon, M. (2000), goes
            in favor of the forecast combination approach, which on average proved to outperform the
            methods individually applied. Same conclusion applies to the more recent M4 forecast com-
            petition, discussed in Mancuso, A. C. B., and Werner, L. (2020), where 12 out of a group of
            17 most accurate methods are based on the combination of forecasts. Other considerations in
            favor of this approach are more closely related to the features of the time series under inves-
            tigation. For instance, in many real-life cases they are affected by structural breaks, induced
            by a variety of factors whose real-time detection is generally difficult to achieve. However,
            in a multi–model setup it is not unreasonable to have models showing different degrees of
            ability in handling such events. Such a situation can translate into gains in terms of forecast
            accuracy, as it has been argued not only since the very beginning, in the above mentioned
            paper by Bates and Granger, but also in more recent times, by, among others, Clements, M.
            P., and Hendry, D. F. (2002), Sessions, D. N., and Chatterjee, S. (1989) and Makridakis,
            S. (1989). All these Authors concur on the premise that, on average, combining the forecasts
            yielded by models with different reaction times to a given intervention – and thus requiring
            stretches of post-break data of different length – can do a better job than individual models.
            For what said, it comes at no surprise that such appealing results might lead to a change in
            the perspective many researchers and practitioners look at the forecasting methods, i.e. from
            model selection – based on the assumption of the existence of one, “true” data generating
            process – to model averaging.
                When the data set under investigation show a hierarchical structure, forecast combination
            techniques (but this holds true for any univariate forecasting procedure) are insensitive to the
            level of aggregation at which they are applied. Consistently, in such cases, the independent
            forecasting of the component time series is always possible, even if not advisable, due to the
            very likely lack of consistency occurring between the sum of the predictions generated at
            one level with those available at the level above. But this is not the whole story: by applying
            forecasting procedures at the components level, rather than limit them to the most aggregate
            one, it is possible to adequately capture the data covariance structure and thus achieve not
            negligible gains in terms of quality of the predictions. This fact has been pointed out, inter
            alia, by Fair, R. C., and Shiller, R. J. (1990), Marcellino, M., Stock, J. H., and Watson,
            M. W. (2003) and Hubrich, K. (2005). Their conclusions are related to two of the most
            traditional approaches, usually referred to as Top-Down and Bottom-Up (see, for example,
            Schwarzkopf, A. B., Tersine, R. J., and Morris, J. S. (1988), Lapide, L. (2006) and Athana-
            sopoulos, G., Ahmed, R. A., and Hyndman, R. J. (2009)). While the former envisions a
            two-step procedure – i.e. the forecasting is first performed at the top level and then, by disag-
            gregating these data based on the historical percentage of each data point, within the whole
            group – in the latter each and every time series is first individually predicted and then all the

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
            4
            forecasts are summed up. There is another approach which has gained widespread acceptance
            over the years, known as “middle-out”. It can be considered an extension of the top-down ap-
            proach, since the forecast is first generated at two separate levels (upper and lower) and then
            combined in a proprietary manner to form a composite forecast. It is worth outlining how all
            of these methods can be considered sub-optimal insofar they neglect the correlation struc-
            ture existing among the series belonging to the same level. Finally, a more recent approach
            known as optimal combination, envisions a two-step procedure where first the sequential and
            exhaustive forecast of each and every time series is independently performed and then – by
            optimally combining the predicted values obtained – are aggregated to achieve consistency
            across the hierarchical levels (reconciliation). Theoretically, cross-level coherency can be at-
            tained by means of Generalized Least Square (GLS) whose employment, however, turns out
            to be unfeasible due to the unidentifiability of the covariance matrix of the reconciliation
            errors ( Wickramasuriya, S. L., Athanasopoulos, G., and Hyndman, R. J. (2019)). However,
            other methods, e.g. of the type OLS (Hyndman, R. J., Ahmed, R. A., Athanasopoulos, G.,
            and Shang, H. L. (2011)) or WLS ( Hyndman, R. J., Lee, A. J., and Wang, E. (2016)) can
            be used to circumvent this hurdle.
                The method proposed in the present paper is of the type mixed, in the sense that exploits
            the approaches related to both forecasts reconciliation and forecasts combination. It is noted
            how mixed methods of this sort are not often encountered in literature. Such a situation might
            be due to the relatively recent introduction of reconciliation methods capable, unlike more
            traditional procedures, of accounting for the correlation structures among the series within
            a given hierarchical level, and thus able to deliver better performances. On the other hand,
            the need of a unified framework combining these two approaches has been recently brought
            up by Di Fonzo, T., and Girolimetto, D. (2020), which discussed an ad hoc, bi-dimensional
            (cross-sectional and temporal) procedure built upon a recent proposal by Wickramasuriya,
            S. L., Athanasopoulos, G., and Hyndman, R. J. (2019). Their method employs all the sum-
            mation constraints arising in the cross-temporal hierarchic structure to reconciliate the base
            forecasts, using simple projections in a suitable linear space. On the other hand, the recent
            proposal by Spiliotis, E., Petropoulos, F., and Assimakopoulos, V. (2019) envisions a com-
            mon framework where both forecast reconciliation and combination of forecasts generated
            by multiple models work together. Their method arises from the consideration that base fore-
            casts should not be derived from a single method but a combination of methods. In the same
            direction goes the early work by Van Erven, T., and Cugliari, J. (2015), where both combi-
            nation and reconciliation of the forecasts are applied in a two-step procedure, i.e. “first one
            comes up with the best possible forecasts for the time series without worrying about aggrega-
            tion consistency and then a reconciliation procedure is used to make the forecasts aggregate
            consistent”. As it will be seen, the procedure illustrated in the present paper significantly dif-
            fers from the above mentioned ones, in that different base forecasts are generated according
            to an arbitrary, pre-specified portfolio of statistical models, so that the combination exercise
            is performed on a set of already reconciled forecasts. Finally, while these authors focus on
            temporal aggregation this paper considers cross-sectional aggregations.
                3. The framework . In this Section, an explanation of the framework within which the
            proposed method operates is given. In particular, the hierarchy structure of reference along
            with the employed reconciliation method are illustrated. The forecast combination part will
            be explained using two real-life examples of portfolios – which will be both used in the
            empirical Section – related to the statistical prediction models and the forecast combination
            techniques entertained.

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                FOREASTING HIERARCHICAL TIME SERIES                                            5
                3.1. Hierarchical cross-sectional reconciliation: the chosen method. This paper focuses
            on structures of the type summation constrained, in the sense that the underlying hierarchic
            structure of a given m−dimensional time series xt , arises by summing up the bottom-level
            series into the higher ones. Figure 1 is an example of such a structure, under the condition
            that the constraints xt = xa,t + xb,t , xa,t = xaa,t + xab,t + xac,t and xb,t = xba,t + xbb,t are all
            satisfied.
                                                                         xt
                                                                xa,t            xb,t
                                                        xaa,t xab,t xac,t xba,t xbb,t
                                                Fig. 1: A two-level hierarchical structure
                Formally, we have that the observed data xt – as well as their estimated future values, de-
            fined as xh ; h = 1, 2, . . . , H , with H the prediction horizon – lie in the summation-coherent
            subspace {U} ; ∀t = 1, 2, . . . , T and ∀h = 1, 2, . . . , H . The prediction step subscript h has
            been omitted in Figure 1, for the sake of a better readability. In total, this hierarchy con-
            tains m = 8 time series, n = 5 of which are the lowest level time series, which therefore
            constitute the highest level of disaggregation. The observed series xt ∈ Rm can be broken
            down as follows: xt = [uTt , bTt ]T , where bTt ∈ Rn and uTt ∈ Rm−n respectively contain the
            data pertaining to the bottom and upper series. Therefore, according this representation, the
            structure of Figure 1 (omitting the subscript t) can be broken down as follows: [uTt , bTt ]T ≡
            [x, xa , xb , xaa , xab , xac , xba , xbb ]T , uTt ≡ [xa , xb ]T and bTt ≡ [xaa , xab , xac , xba , xbb ]T . The hi-
            erarchic structure – satisfying x ⊂ {U} – is induced by the summing matrix S of dimension
            m × n such that x = Sbt . Formally: x ⊂ {U} ⇐⇒ xt = Sbt (the symbol ⇐⇒ replacing
            the locution “in and only if”). The S matrix for the hierarchy in Figure 1 is as follows:
                                                                      11111
                                                                              
                                                                     1 1 0 0 0
                                                                     0 0 1 1 1
                                                                              
                                                                     1 0 0 0 0
                                                                              
                                                               S=
                                                                     0 1 0 0 0
                                                                               
                                                                     0 0 1 0 0
                                                                              
                                                                     0 0 0 1 0
                                                                      00001
                Using the symbols ˜ and ˆ respectively to refer to the case of coherent and base
            (generally non coherent) forecasts, the reconciliated forecast h− step ahead can be expressed
            as proposed by Hyndman, R. J., Ahmed, R. A., Athanasopoulos, G., and Shang, H. L. (2011),
            i.e.
                                                              x̃(h) = SP x̂(h),                                              (1)
            for some appropriately chosen matrix P ∈                   Rm×n .  Assuming unbiased base forecasts, the
            best (in the sense of minimum sum of variances) linear unbiased revised forecasts are given
            by Equation 1 with
                                                       P = (S 0 W −1 S)−1 S 0 W −1                                           (2)

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                         It is made available under a CC-BY-NC 4.0 International license .
            6
            and thus (see Taieb, S. B., Taylor, J. W., andHyndman, R. J. (2017), Theorem 1)
                                                  x̃(h) = S(S 0 W −1 S)−1 S 0 W −1 x̂(h),                                 (3)
                where S is as above defined and x̂(h) and x̃(h); h = 1, 2, . . . , H represent respectively
            the set of H predictions independently generated and the ones made coherent. Finally, W is
            the positive definite covariance matrix of the base forecast errors, i.e. êt (h) = x̂t (h) − xt (h),
            so that W (h) = E[êt (h) − ê0 t (h)]. As shown by Wickramasuriya, S. L., Athanasopoulos,
            G., and Hyndman, R. J. (2019), matrix W appears in the equation for the estimation of the
            error variance of the reconciled forecasts, i.e.
                                         V (h) = V ar[x(T + h) − x̃(h)] = SP W (h)P 0 S 0 ,                               (4)
                whose diagonal elements are the variances of the forecast errors. Their minimization can
            thus be performed in terms of the trace of V (h) and given by Equation 2 (therefore, this
            method is called Minimum Trace Estimator). Unfortunately, as proved by the same Authors,
            W is not identifiable, therefore, in the empirical section, the workaround proposed by them
            will be adopted. In essence, it is assumed Wh = k(h)diagŴ1 ; ∀h and assuming k(h) > 0
            and denoting P with W1 the forecast errors covariance matrix estimated at horizon h = 1 – i.e.
            Ŵ1 = T1 T1 et e0t – and with K is an unknown constant depending on the time horizon h.
                3.2. The Forecast combination methods adopted. As already mentioned, the proposed
            method uses a set of combination methods, out of which the winner is selected according to
            a suitable loss function. In many empirical studies, it is shown how forecast combinations on
            average delivers better performances than methods based on a single forecasting statistical
            models. The theoretical validity of this approach is rooted in the assumption that the dimen-
            sion of the sample sizes available in real-life applications are usually finite and, as a result,
            the correct specification of the “true” underlying data generation process is not attainable.
                In what follows it is assumed xt to be the variable of interest and that ft = (f1t , f2t , . . . , fN t )0
                  P N , not perfectly collinear, available
            are the                                                      forecasts, whose combination is expressed as
            f= N           w
                      i=1 i it f   , or,  equivalently,    f =  ft
                                                                  0 w , being w ’s the combination weights.
                The first method considered in this paper is of the type simple average. Despite its inherent
            simplicity (it ignores the correlation structure of the forecast errors) this method has been
            adopted given its ability, proved true in many cases, to “dominate more refined combination
            schemes aimed at estimating the theoretically optimal combination weights” (Atiya, A. F.
            (2020)). The simple average assigns equal weights to all predictors, i.e. wsa = N1 and thus
            the combined forecast is
                                                                   f = ft0 wsa .
            In the second method chosen, the forecast combination weights wols = (w1 , w2 , . . . , wn ),
            along with the intercept b, are computed using ordinary least squares (OLS) regression
            (Granger, C. W., and Ramanathan, R. (1984)), i.e.
                                                                f = b + ft0 wols .                                        (5)
            The third method applied – of the type Least Absolute Deviation (LAD) – is a modification
            of the OLS method, and it is expressed as in Equation 5, replacing the superscript ols with
            lad. Since the method of least squares assigns heavy weights on the error terms,the more
            robust estimator LAD – suggested by Gauss and Laplace – minimizes the absolute values
            and not the squared values of the error term. This features is particularly useful when the

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                FOREASTING HIERARCHICAL TIME SERIES                                         7
            error term is generated by distributions having a infinite variance (fat tails) caused by outliers
            in the disturbance term.
                Finally, a modification of the method proposed by Newbold, P., and Granger, C. W. (1974),
            built upon an earlier
                                P         methodology of Bates, J. M., and Granger, C. W. (1969), is our fourth
            approach. Let be the positive definite matrix of the mean squared prediction errors (MSPE)
            of ft and g is an N × 1 vector of (1, 1, . . . , 1)0 their method relies on a constrained minimiza-
            tion of the MSPE under the normalizing condition g 0 w = 1. The resulting combination of
            weights is
                                                                        P−1
                                                                ng           g
                                                              w = P−1 ,
                                                                      g 0      g
            so that the combined forecast is
                                                                 f = ft0 wng .                                            (6)
            However, unlike the original method, the variant employed here follows the proposal by
            Hsiao,
            P         C., and Wan, S. K. (2014), which does not impose the prior restriction that the matrix
                 is diagonal.
                3.3. The entertained statistical models. Before delving into the proposed method, a
            quick presentation of the forecasting methods employed in the empirical section is in order.
            The first two statistical models considered are of the type ARIMA (Auto Regressive Frac-
            tional Moving Average) ( Box, G. E., Jenkins, G. M., and Reinsel, G. (1970)) and ARF IM A
            (Auto Regressive Fractional Moving Average) (Granger, C. W., and Ramanathan, R. (1984)
            and Granger, C. W., and Joyeux, R. (1980)). Being the latter a generalization of the former,
            the two models will be presented conjointly.
                ARF IM A (Auto Regressive Fractional Moving Average) models are useful in circum-
            stances where the underlying stochastic process exhibits hyperbolic decay patterns in their
            estimated autocorrelation function. ARFIMA-type processes are usually expressed as fol-
            lows:
                                           Φ(B)(1 − B)d xt = Θ(B)εt ;           εt ∼ i.i.d.(0, σ 2 ),
            where d is a parameter – assumed to take non-integer values in the difference operator
            (1 − B)d , with B identifying the backward operator, that is B k xt = xt−k . The fractional
            differencing operator is defined by the binomial expansion (1 − B)d = ∞                             d           i
                                                                                                          P       
                                                                                                           0    i (−B) .
            The process is stationary and invertible if the roots of the autoregressive polynomial of
            order p, Φ(B) = 1 − φ1 B − φ2 B 2 , . . . , −φp B p , and the order q moving-average part,
            Θ(B) = 1 + θ1 B + θ2 B 2 + · · · + θq B q , lie outside the unit circle with |d| < 0.5.
                ARFIMA models generalize the ARIMA(p,d,q) representation where the parameter d is
            constrained to integer values. This type of model has been designed to capture approximately
            parabolic decay patterns of the empirical autocorrelation function. As such, they are suitable
            to model persistence structures embedded in the underlying stochastic process of the type
            short-memory.
                Theta method – the third forecasting model considered – is a powerful class of models
            which have been proposed by Assimakopoulos, V., and Nikolopoulos, K. (2000). Define

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
            8
            with the symbol ∇ the difference operator – i.e. ∇xt = xt − xt−1 , xt being the original time
            series – this method is the solution of the equation
                                                   ∇2 zt (θ) = θ∇2 xt ;     t = 3, 4, . . . , n,                           (7)
            with zt (θ)’s analytical solution reading as following: zt (θ)θxt + (1 − θ)(An + Bn t); t =
            1, 2, . . . , n, where An and Bn are the minimum square coefficient of a linear regression equa-
            tion of the series xt against 1n , i.e. the vector       h of   ones of length n. Theseiterms are given by
                      1 Pn                                             2 PN                     PN
            An = N t=1 xt − 2 Bn and Bn = n2 −1 N t=1 xt t − 1+n
                                        n+1                      6
                                                                                            n     t=1 xt . Finally, the initial
                                                                                                 Pn
            values z1 and z2 in Equation 7 are estimated by minimization of t=1 (|xt − zt (θ)|2 ).
                The fourth and last model employed is of the type exponential smoothing, proposed in
            1944 by Robert G. Brown, a US Navy operations research analyst ( Gardner Jr, E. S. (2006)).
            Specifically, two schemes have been employed here: Additive Holt Error Model ( AEM )
            and multiplicative Holt Error Model (M EM ) (as it will be seen, the procedure automatically
            will select the “best” one). As for the AEM , let µt = x̂t = lt−1 + bt−1 be the one-step
            ahead forecast of the observed time series xt generated by the forecasting equation xt =
            lt−1 + bt−1 + εt , being lt a measure of the level of the series, bt an estimate of the slope (or
            growth) at time t and εt = xt − µt the one-step-ahead forecast error, referred to the time t.
            The level and slope equations for AEM are respectively represented as
                                             lt = lt−1 + bt−1 + αεt
                                             bt = bt−1 + β(lt + lt−1 − bt−1 ) = bt−1 + αβεt .
            By re-expressing the error term εt as εt = (xtµ−µ             t
                                                                            t)
                                                                               (relative errors), the forecast, level and
            slope equations for the M AM model are as follows:
                                                      lt = (lt−1 + bt−1 )(1 + αεt )
                                                     bt = bt−1 + β(lt − 1 + bt−1 )εt .
            In the above two sets of equations α and β are the model parameters to be estimated.
                4. The proposed method. Let us indicate with the symbols R and |·| respectively a suit-
            able reconciliation method and the cardinality function (assuming the number of elements in
            a given set to be finite, | · | simply returns the number of the elements belonging to that set).
            Let the symbol ncol identify the function which, applied to a given matrix, returns its num-
            ber of columns and M ≡ {µ1 , µ2 , . . . , µM } and D ≡ {δ1 , δ2 , . . . , δD } respectively the set of
            |M| = M prediction models and the set |D| = D of forecast combination methods enter-
            tained, both arbitrarily chosen. Once applied to the time series of interest xt ; t = 1, 2, . . . , T ,
            each model {µj ∈ M; j = 1, 2, . . . M } generates a set, called F H , made up with M H –step
            ahead predictions, i.e.: {F H (µj ); j = 1, 2, . . . M }. Each of the elements of this set is a base
            forecasts, in the sense that it is generated by individually applying a given statistical model
            µj to the observed time series without any attempt of reconciliation.
                Each of these M elements in F (the M forecast vectors) is individually reconciled
            through the reconciliation procedure R, i.e. {R(F (µj ); j = 1, 2, . . . M )} (the superscript
            h is omitted for brevity). At this point, the resulting set {P(µj ); j = 1, 2, . . . M } of M
            model–dependent reconciled forecasts (first optimization) is optimally combined by apply-
            ing each method in the set D to any possible combination (without repetition) of order
            {k = 1, 2, . . . , M } to the set P (second optimization). The resulting set Z – with cardi-
                               P|P|
            nality (|D| ∗ k=1 M
                                             
                                          k ) – contains all the possible combinations – ∀k -order – of the model-
            dependent reconciled forecasts. The third optimization step is carried out by applying to Z

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                 FOREASTING HIERARCHICAL TIME SERIES                                           9
            a suitable loss function, here denoted with the symbol L(·). The optimal vector of forecasts
            is thus the element z ∗ ∈ Z minimizing this function, i.e. z∗ = min L(Z). This optimality
            condition is expressed as
                                                                z∗ = f (µ∗ , δ ∗ ),                                          (8)
            being the arguments of f respectively the “best” forecasting model and forecast combination
            technique. This last step, by ruling out the less performing combination method(s), has been
            introduced in order to reduce the overall uncertainty level of the analysis. In fact, suppose
            that the original set D reduces to D 0 – being clearly |D 0 | < |D| – the additional amounts
            of undesired fluctuations and noise – which one can reasonably expect as a consequence
            of the employment of one (more) under-performing combination method(s) – are avoided.
            Finally, the model bias β ∗ is empirically estimated using the in–sample residuals generated
            by employing the winners techniques µ∗ and δ ∗ , according to an optimal choice made on a
            set of suitable central tendency functions (fourth optimization).
                For the sake of clarity, a more schematic description of the method is given below, in the
            form of algorithm presented in a step-by-step fashion.
                                                  Figure 1 Algorithm of the proposed method
                                                                                              Reconciliation procedure R is
                                   Let xt ; t ∈ T be the time series                          applied to F H (µj ) ∀j, s.t. the
                                   of interest of length T , define a               5       set P of the reconcilied forecasts
                       1           suitable portfolio of forecasting                          of cardinality |P| is generated
                                     models M ≡ {µ1 , . . . , µM }
                                                                                            All the forecast combination pro-
                                                                                             cedures (set D) are exhaustively
                                                                                            applied to all the possible combi-
                                         Define the portfolio of                    6       nations of order {k = 1, . . . , |P|},
                       2                  forecast combination                                 so that the setPZ with cardi-
                                      methodsD ≡ {δ1 , . . . , δD }                                             |P|
                                                                                               nality (|D| ∗ k=1 |P|
                                                                                                                         
                                                                                                                       k ) of
                                                                                                reconcilied forecasts is built
                                                                                               A suitable loss function L(·)
                                                                                                 is applied to Z so that the
                                             Define the Recon-                      7              winner forecast element
                       3
                                            ciliation method R                                     z∗ ∈ Z is extracted. In
                                                                                                  symbols z∗ = min L(Z)
                                                                                               The forecasting model µ∗ and
                                                                                                the combination method δ ∗
                                          The M H–step ahead                        8         generating z∗ are extracted and
                       4                  base forecasts x̂H j,t =                              employed to compute the in
                                      H
                                   F (µj ); ∀j ∈ M are generated                              sample estimate of the bias β ∗
                The novelty of the proposed method is basically captured by steps 5–7 and 8. For the sake
            of a more operational comprehension, step 5–7 are now discussed using the matrix notation
            whereas step 8 will be detailed in Subsection 4.1. Step 5 indicates that once a number M of
            different forecasts, generated by M models, become available for each level of the hierarchy,

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
            10
            they are reconcilied one at a time through R. In practice, the reconciliation function R,
            applied to the given hierarchic structure, generates a sequence of H × 1 vectors of reconciled
            predictions pH      j , as below schematized.
                            Figure 2 Illustration of the procedure to obtain the vectors of reconcilied forecasts
                           µ1 ⊂ M                                    F H (µ1 )                       R(F H (µ1 )) = pH1
                           µj ⊂ M                                    F h (µj )                       R(F h (µj )) = phj
                           µM ⊂ M                                    F h (µM )                      R(F h (µM )) = phM
                Each vector pH,j can be seen as the column of a matrix, say PH,M , containing all the M
            model-dependent reconcilied forecasts. In the following step 6, these M (column)-vectors
            of predictions are combined according to a number D of different combination methods
            (δ1 , . . . , δD ). In essence, they are sequencially and exhaustively applied to each of the possible
            combinations of order {k = 1, . . . , ncol(P )} of the column vectors of PH,M . Defining the
            combination (without repetition) function with Ck and setting, for instance,                   the combination
                                                              k0                                        M
            order k = k0 < M , the submatrix PH,M = Ck0 (PH,M ) stores all the k0 combinations of
                                                             k0                H
            the forecasts pH      j ; j = 1, . . . , ncol(PH,M ), called zj , as illustrated in the Figure below.
               Figure 3 Illustration of the procedure to obtain the vectors of model dependent reconcilied forecasts
                                                                 δ1 PkH,M = z1H
                                                                 δj PkH,M = zjH
                                                           δD PkH,M = zncol(P
                                                                           H
                                                                                 k
                                                                                 H,M )
                By looping over all of the combination orders k = 1, . . . , ncol(PH,M ), the matrix Z con-
            taining all the possible combination of the M model dependent reconcilied forecasts is ob-
            tained. This matrix is called Z and has dimensions
                                                           H × D ∗ ncol(PH,M ).                                           (9)
            Step 7 translate into simply applying a suitable loss function to Z (column-wise), until the
            final vector of predictions z ∗ , verifying the minimum condition min L(Z), is extracted.
                4.1. The bias correction procedure (step 8). It is well known that a perfectly unbiased
            forecast is a condition not frequently met in many real-life applications. Unfortunately, the
            unbiasedness of the forecasts reconciliation method chosen (Equation 2), depends on the
            unbiasedness of each and every base forecasts, as proved by Wickramasuriya, S. L., Athana-
            sopoulos, G., and Hyndman, R. J. (2019). The proposed method can alleviate this problem
            as it is designed to generate a “big” competition set (Z ), made up with more “balanced”

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                FOREASTING HIERARCHICAL TIME SERIES                                        11
            forecasts (thanks to the forecast combinations techniques applied) and thus more likely to
            perform better than methods generating fewer or just one forecast vector.
                The bias correction of the forecast values stored in the vector z∗ – obtained in step 7 of
            Figure 1 – is performed using an improved version of the simple, yet effective, procedure dis-
            cussed in Spiliotis, E., Petropoulos, F., and Assimakopoulos, V. (2019). In more details, the
            adopted method translates into a six–step iterative procedure, designed to empirically esti-
            mate a set of in-sample tentative biases {β ≡ β1 , β2 , . . . , βB }, each of them obtained accord-
            ing to a predefined, arbitrary set of suitable central tendency functions {a1 , a2 , . . . , aA ⊂ A},
            being |β| = |A| (or, equivalently, B = A).
                Recalling that xt is the observed time series, let us denote with x̂∗t = f (µ∗ , δ ∗ ) its one-
            step-ahead predictions – obtained according to the optimal forecasting model and prediction
            combination method (see Equation 8) – and with εt |βj the vector of residuals between these
            two series conditional to a given central tendency function, i.e. εt |βj = xt − x̂∗t |βj (αj ). In
            what follows, the term αj is omitted as it is understood the dependency relationship between
            bias and central tendency function, i.e. bias = βj (αj ). The set β is thus generated by itera-
            tively and exhaustively applying each function in A to the bias adjusting equations which,
            once expressed in terms of residuals, read as follows:
                                                  βj
                                                     εt = xt − x̂∗t |βj ;     j = 1, 2, . . . , B,                      (10)
                                                     βj          xt
                                                        ηt =           ;   j = 1, 2, . . . , B.                         (11)
                                                              x̂∗t |βj
            Equations 10 – 11 differ only for that the one-step ahead predictions are respectively adjusted
            additively and multiplicatively. Finally, by applying a suitable loss function, E(·) to each of
            the vectors βj εt and βj ηt , the optimal bias estimation is its minimzer, i.e.
                                                 β ∗ = min(βj εt ;βj η);       j = 1, 2, . . . , B.                     (12)
                                                          E
            Once the final bias is computed, it can be readily applied in a forward looking fashion, i.e.
                                                        a
                                                          yt,H = z∗,H + β ∗ (xt − z∗t )                                 (13)
            or
                                                                                  xt
                                                            m
                                                              yt,H = z∗,H ∗ β ∗       ,                                 (14)
                                                                                  z∗t
            according to whether the winner central tendency function is applied in an additive (Equation
            13 ) or multiplicative fashion (Equation 14). The generilzed notations for the first term in
            Equations 4.1 and 4.1 is
                                                                      u
                                                                        yt,H ,                                          (15)
            which represent the final predictor. In such an approach, the future and the past are assumed
            to be affected by the same amount of bias. Such an assumption, under stationaity of the
            observed time series and a “sufficient” sample size, might not be considered unreasonable.
                In the case of {β ≡ β1 } with β1 the mean function, Equations 13–14 are respectively as
            follows:
                                                                               T
                                                                           1X
                                                     a
                                                       yt,H = z∗t,H +            (xt − z∗t )
                                                                          T
                                                                             t=1

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
            12
            or
                                                                               T
                                                                           1 X xt
                                                         m
                                                           yt,H = z∗t,H  ∗             ,
                                                                           T       z∗t
                                                                              t=1
            and thus equivalent (saved for the notation) to the procedure discussed in Spiliotis, E.,
            Petropoulos, F., and Assimakopoulos, V. (2019) (Equations 3–4), page 21.
                In the empirical application of Section 6, the central tendency functions applied are: mean,
            median and root mean square, respectively denoted by the lowercase Greek letters π , τ and
            ξ . Their mathematical representations is as follows:
                                                                                                            v
                                T                                                                           u T
                            1  X                        1                                                 1 uX
                 π(·) =             xt ,        τ (·) = x(b T +1)/2 c + x             ,       ξ(·) = t          x2t . (16)
                           T                            2                    (T +1)/2                     T
                               t=1                                                                            t=1
                                                                                                                          
            In the case of the median (τ (·)) x is an ordered list of T values, and the symbols b·c ·
            denote the floor and ceiling functions, respectively.
                5. Justification of the method. The effectiveness of the proposed method is, in general,
            conditioned to the choices of the statistical prediction models and the forecast combination
            techniques included in the sets M and D , as well as to the selection of the most suitable cen-
            tral tendency functions (the set A). A careful building of those sets (our multidimensional
            search space), is a prerequisite for the proposed method to properly perform. Its final dimen-
            sions are as in Expression 9 plus twice the number of central density functions considered,
            used in both additive and multiplicative fashion, i.e.
                                                    H × [2 ∗ |A| + D ∗ ncol(PH,M )] .
            The point of strength of the method is thus related to the availability of a potentially large
            number of multiple choices, all of them derived in a multiple combination set-up (in terms
            of statistical prediction model, forecast combination and bias correction), so that the selected
            forecast vector are the minimizer of a bi-dimensional loss function (L, E). In addition, the
            method is very flexible, as it can work with all the methods deemed suitable for the problem at
            hand, being the only limit the computational time. This is certainly an issue, which, however,
            can be easily circumvented thanks to the structure of the method itself, which is naturally
            prone to be parallelized.
                According to the bias–variance decomposition approach, the mean square error (M SE )
            can be decomposed into a bias β and a variance (V ) terms, i.e.
                                                               M SE = β 2 + V                                           (17)
            In what follows, the advantages related to the proposed method will be illustrated in terms of
            Equation 17. Firstly, it is noted how, in general, simpler models tend to produce large biases
            and small variances whereas complex models behave in the opposite way. The proposed
            method is designed to overcome such an issue not only because it can employ a combination
            of several models with different levels of complexity but also because it selects the “best”
            combination technique (stored in the set D ) according to the data set under investigation.
            This last feature is clearly a plus, since there is not such combination techniques able to
            perform optimally in any circumstances. For example, Palm, F. C., and Zellner, A. (1992)
            found that there are cases where a simple average combination may be more robust than

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                FOREASTING HIERARCHICAL TIME SERIES                                        13
            weighted average combinations. Therefore, by iteratively testing many different techniques,
            one is more likely to find the most suitable (if not the “optimal”) one.
                Bias-wise, the advantages of this method are related to its self-balancing and self-adjusting
            features, the former being induced by the bias compensation phenomenon, more likely to
            occur in a multi-model set up, whereas the latter relies on the bias correction procedure,
            given in Section 4.1. In particular, its effectiveness in bias reduction is related to the fact that
            the self-adjustment procedure uses a vector of forecast which, by design, has already been
            controlled for bias. To see this, let us express the generic forecast combination x̃H             t as
                                                                   XM
                                                           x̃Ht =       wi F H (µi ),
                                                                   i=1
            with wi = f (δ̃) the combination weights generated by the combination method δ̃ and
            F H (µj ); j = 1, . . . , M are base forecasts generated by the M statistical models entertained
            (see Figure 1 step 1 and 4). Assuming 0 ≤ wj ≤ 1, M
                                                                                 P
                                                                                   i=1 wi = 1 and the vector of “future”
            observations of length H to be known, the total amount of bias of the combined forecast is
            given by
                                                         β = E(x̃H  t − xt )
                                                                            H
                                                               XM
                                                           =       wi [Ex̃H           H
                                                                            t,i − Ext ]
                                                               i=1
                                                               XM
                                                           =       wi β i ,                                             (18)
                                                               i=1
            where the subscript i is used to refer to a specific model, in terms of generated bias (βi ) and
            forecast ( x̃H    t,i ). The right term of Equation 18 shows that the bias of the forecast combina-
            tion is the weighted average of the biases of the base forecasts and thus, provided that their
            magnitude is comparable, one can reasonably expect an overall bias reduction due to cancel-
            lation effects. Such a phenomenon is not rare, since – in general – it is not common for all
            the biases to show the same sign. Since the bias-correcting method – discussed in Section
            4.1 – is applied on an already optimally combined vector of forecasts z∗t = xt (δ ∗ , µ∗ ), a less
            pronounced bias can be expected in the final predictions, given by
                                                                   ∗
                                                      u
                                                        yt,H = zt,H    + β ∗ (xt − zt∗ ),                               (19)
            where β ∗ is as in Equation 12.
                The proposed method can also help keep low the variance of the forecasts in an amount
            inversely proportional to the correlation coefficients computed between the competing fore-
            casts and proportional to the reduction in the standard errors induced by the reconciliation
            procedure adopted R. To see this, denoting with σi2 the variance of the individual forecast i
            and with γi,j the correlation coefficient computed on a generic pair (i, j ) of forecasts, we use
            the following inequality (derived in Atiya, A. F. (2020)), i.e.
                                                 XN               XN X    N
                                            V ≤      wi σi2 − 2                wi wj (1 − γi,j )σi σj ,                 (20)
                                                 i=1              i=1 j=i+1
            where V is the variance of the combination of forecasts. Inequality 20 states that V tends to be
                                                                                                                          1
            considerably less than the average of the individual forecasts in an amount depending on γi,j                    ,

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
            14
            meaning that less correlated forecasts are beneficial in terms of variance reduction. Such a
            situation is more likely to occur in procedures which, as the one proposed, grant a “sufficient”
            number of predictions. However, there is another point in favor of the proposed method on
            this matter. In fact, recalling that the different combinations of the forecasts are performed
            on already reconciled vectors of predictions zH            t – according to the adopted procedure R – by
            virtue of Equation 4 their variances obey to the following inequality:
                                                    V ar(zH                  H
                                                             t ) < V ar(xt ); ∀z ∈ Z.                                   (21)
            Therefore, the overall level of variance in Equation 20 decreases of an amount inversely
            proportional to V ar(zH         t ).
                6. Empirical study. In this section the goodness of the proposed method will be evalu-
            ated using the official time series related to the number of people tested positive to the SARS-
            CoV-2 in each of the Italian regions, between February 24th 2020 and October 7th 2020. The
            whole data set – issued by the Italian National Institute of Health – are publicly and freely
            available at the web address https://github.com/pcm-dpc/COVID-19/tree/master/dati-regioni.
            The data, sampled at a daily frequency, are stored in a matrix called O (see Table 1) of
            dimension 227 × 21, where 21 are the Italian regions. From a strictly administrative point
            of view, the number of the Italian regions amounts to 20, however, for one of them, called
            Trentino Alto Adige, the data are split according to its two main towns: Trento and Bolzano.
            As reported in the same Table 1, the proposed procedure is trained on a portion of the data
            matrix, called O train , of dimensions 197 × 21 and time span February 24th – September 7th ,
            whereas the test part is carried out on a set, called O test , whose dimensions are H = 30 × 21
            (the time span is from September 8th to October 7th ). Finally, 30 days ahead “real-life” es-
            timates – in the sense that they are related to future values which are unknown at the time
            of their computations – for the time window October 8th – November 7th will be stored in
            the matrix O f ore . Since the proposed procedure combines a number of models (µ’s), com-
                                                                    TABLE 1
                          The employed data set and its portions defined according to the different purposes served
                                           Symbol    Start date         End Date         Sample size
                                           O         February 24th      October 7th          227
                                           O train   February 24th      September 7th        197
                                           O test    September 8th      October 7th           30
                                           O f ore   October 8th        November 7th          30
            bination methods (δ ’s) and central tendency functions (E 0 s), for each of those, conventional
            symbols are respectively given in Tables 2, 3 and 4. Consistently with the convention in-
            troduced in Equation 15, in Table 4 the superscript u is used to indicate the type of bias
            considered, i.e. additive (u = a) or multiplicative (u = m). Finally, to efficiently keep track
            of the outcomes of the method, in Table 5 the whole set of model combinations employed
            – respectively of class k = 4, 3, 2 – are provided. Since we have four different combination
            methods, each of the 11 model combination (reported in Table 5) are performed four times,
            which yields a total of 44 method-dependent combinations. One of them, for example, is the
            forecasts combination generated by combining an ARFIMA and an ETS models using the
            method Ordinary Least Square. This information is conveniently conveyed by the symbol
            OLS–AE.

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                FOREASTING HIERARCHICAL TIME SERIES                                          15
                                    TABLE 2                                                         TABLE 3
                 Symbols employed to identify the statistical                 Symbols employed to identify the central tendency
                                     models                                                        functions
                              Model (µ) Symbol                                      Method (δ)                    Symbol
                              ARFIMA            A                                   Ordinary Least Square         OLS
                              ETS               E                                   Least Absolute Deviation      LAD
                              THETA             T                                   Newbold and Granger           NG
                              ARIMA             B                                   Simple Average                SA
                                                                                                    TABLE 5
                                                                                Combinations of models of class K = 4, 3, 2
                                                                               attempted for each of the four model-dependent
                                                                                            reconcilied forecasts
                                    TABLE 4                                         Number      K      Model combination
                 Symbols employed to identify the statistical                       1            4     A–E–T–B
                                     models                                         2                  A–B–E
                    Central tendency function Symbol                                3            3     A–B–T
                                                       u                            4                  A–E–T
                    Mean                                 π
                                                       u                            5                  B–E–T
                    Median                               τ
                    RMS                                u
                                                         ξ                          6                  A–B
                                                                                    7                  A–E
                                                                                    8            2     A–T
                                                                                    9                  B–E
                                                                                    10                 B–T
                                                                                    11                 E–T
                Recalling that with u yt,H the final predictions yielded by the proposed method are de-
            noted (see Equation        q 15),     the loss function employed (L) is the Root Mean Square Error
                                            1 P30
            (RMSE), given by T h=1 (xt,H − u yt,H )2 . The same function is adopted in–sample to
                                                                q P
            select the best 3–tuple (µ , δ , E ), i.e. T1 227
                                                ∗   ∗   ∗                            u     2
                                                                         t=1 (xt − yt ) and to evaluate the method’s
            performance in the test set O test . Finally, the out of sample estimate of the bias, in the se-
            quel   denoted by the symbol β out , has been computed on the set O test , using the formula
             1 PT                    uy
            T      t=1 (xt −            t,H ).
                6.1. Performances of the method. The performance of the method are summarized in
            Appendix A and in Table 6. In particular, in Appendix A the observations belonging to the
            test set O test (black line) and the related estimates u yt,H (red line) are depicted. The first
            three columns of Table 6 respectively indicate the name of the Italian regions, the winner
            combination (µ∗ , δ ∗ ) and the related RMSE values (L∗ ). The best central tendency function
            (E ∗ ), the selected bias corrector( β ∗ ) and the estimated out-of- sample bias ( β out ) are given in
            columns four, five, six. In the last two columns the RM SE values (L ) relative to each of the
            forecasting models (reported in Table 2) taken separately, are recorded. The accuracy of the
            proposed method seems to be very good as, in almost all the cases, the winner combinations
            deliver better predictions than all the statistical models singularly considered and, in many
            cases, outperform them. This is the case, for example, of the Campania and Calabria regions.
            Here (see Table 6), the recorded RM SE is respectively equal to 34.7 and 63.5, far below the
            values obtained using the best statistical models, i.e. T heta and ET S , which respectively
            scored L = 143.6 and 265.1. In addition, the proposed procedure shows always from very
            low to negligible in-sample amounts of bias. The most selected central tendency functions is
            a τ and a π , whereas it is noted that the RM S function (u ξ ) has never been chosen. Regarding
            the out-of-sample bias, if on one hand, as expected, it is always β out > β ∗ , on the other hand

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
            16
            it can be said that the magnitude of the values assumed by β out can be deemed acceptable.
            This is especially true if one considers the length of the prediction window (H = 30 days)
            compared with the available data set. In particular, six regions (Valle d’Aosta, Trento, Molise,
            Lazio, Abruzzo, Calabria) show interesting values for the out of sample bias, being β out < 10.
            The worse performances of the method refers to the region of Sardegna, where the consistent
            underestimations of the true values lead to a recorded bias of around 504. This fact can be
            explained by looking at the irregular, bumpy shape of this time series, reported in Appendix 2
            (Sardegna), which might have introduced distortions in the model estimators. In Appendix B,
            the graphical results of a pure out-of-sample application of each of the winner combinations
            are reported. In more details, the region-specific winner combinations (µ∗ , δ ∗ ) are applied
            to the whole set O , so that the H = 30 days–ahead resulting forecasts – stored in the set
            O f ore – are the pure forecasts for the period October 8th – November 7th . In Appendix B,
            the regional time series in O (true observations) are plotted in black whereas the predictions
            are in red color. The analysis of these Figures suggest a slower acceleration in the growth
            of positive cases in some of the north regions (e.g. Lombardia, Trento, Liguria) whereas the
            center and south regions might face a strong increase of positives. This seems likely to happen
            in the Campania, Basilicata and Molise regions. The number of positive for Italy, predicted
            for the end of the pure forecast period (November 7th ), is about of 115,854.

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
   (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                FOREASTING HIERARCHICAL TIME SERIES                                        17
            Table 6: Performances of the method for each of the Italian regions. Outcomes of the winner
            models and of the single statistical models. Refer to the text for details
        Region                 Winner combination               L∗      E∗       β∗          β out       Single models        L
                                                                                                           ARF IM A       1050.8
                                                                         aτ                                  ET S         1065.8
       Piemonte                    LAD − BET                  135.6             ≈0           54.09
                                                                                                                θ         1271.8
                                                                                                            ARIM A         683.6
                                                                                                           ARF IM A          60.7
                                                                         aτ                                  ET S          177.5
     Val d’Aosta                      SA − BT                  8.6              ≈0           -2.25
                                                                                                                θ            30.5
                                                                                                            ARIM A           29.5
                                                                                                           ARF IM A       3184.0
                                                                        mτ                                   ET S          911.7
      Lombardia                       SA − ET                172.6               1.0         70.83
                                                                                                                θ          966.1
                                                                                                            ARIM A        1713.8
                                                                                                           ARF IM A        468.9
                                                                         aπ                                  ET S          227.6
       Bolzano                      OLS − ET                 223.2              ≈0           190.9
                                                                                                                θ          271.2
                                                                                                            ARIM A         248.8
                                                                                                           ARF IM A        113.7
                                                                         aτ                                  ET S            30.0
        Trento                       N G − BE                 29.4              -.13         8.95
                                                                                                                θ          238.2
                                                                                                            ARIM A         211.5
                                                                                                           ARF IM A        620.1
                                                                         aπ                                  ET S            95.5
        Veneto                       N G − BE                  58.5             0.55         49.01
                                                                                                                θ          259.9
                                                                                                            ARIM A           49.6
                                                                                                           ARF IM A        475.4
                                                                         aπ                                  ET S          140.6
Friuli Venezia Giulia                 SA − BE                  65.9             0.70         18.08
                                                                                                                θ          763.5
                                                                                                            ARIM A         155.6
                                                                                                           ARF IM A       4123.8
                                                                         aτ                                  ET S          126.8
        Liguria                     LAD − ET                  124.2             ≈0          -28.13
                                                                                                                θ         1057.7
                                                                                                            ARIM A         241.9
                                                                                                           ARF IM A       2203.4
                                                                         aτ                                  ET S          343.5
  Emilia Romagna                    LAD − BT                  296.7             ≈0         -160.01
                                                                                                                θ          724.5
                                                                                                            ARIM A         274.9
                                                                                                           ARF IM A       3417.7
                                                                        aτ                                   ET S         1202.4
       Toscana                       LAD − AB                259.6              ≈0           149.8
                                                                                                                θ         2485.9
                                                                                                            ARIM A         310.0
                                                                                                           ARF IM A        701.9
                                                                         aπ                                  ET S          254.5
        Umbria                      OLS − AB                  133.3             ≈0          104.54
                                                                                                                θ          344.4
                                                                                                            ARIM A         168.1
                                                                                                          Continued on next page

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
            18
                                                                                                 Continued from previous page
       Region                           model                   L∗      E∗       β∗            α∗        Single models        L
                                                                                                          ARF IM A        2191.6
                                                                        mτ                                   ET S           320
      Marche                        SA − BET                  211.0             1.01        136.65
                                                                                                               θ          1185.7
                                                                                                           ARIM A          355.5
                                                                                                          ARF IM A         522.2
                                                                         aτ                                  ET S          153.5
        Lazio                         SA − ET                  45.9            0.13          7.43
                                                                                                               θ           180.7
                                                                                                           ARIM A           64.7
                                                                                                          ARF IM A         740.2
                                                                         aτ                                  ET S           70.3
      Abruzzo                      LAD − BET                   40.0             ≈0           6.97
                                                                                                               θ           294.6
                                                                                                           ARIM A           40.7
                                                                                                          ARF IM A         250.9
                                                                         aπ                                  ET S         1229.0
       Molise                         SA − AB                  39.2            −.05           -5.8
                                                                                                               θ           147.0
                                                                                                           ARIM A          265.1
                                                                                                          ARF IM A         480.7
                                                                         aτ                                  ET S          359.8
    Campania                          SA − BT                  34.7             .05         -30.52
                                                                                                               θ           143.6
                                                                                                           ARIM A          201.3
                                                                                                          ARF IM A        1991.5
                                                                         aτ                                  ET S          680.6
       Puglia                      LAD − BET                  419.4             ≈0         -249.58
                                                                                                               θ          2507.5
                                                                                                           ARIM A          674.1
                                                                                                          ARF IM A         117.5
                                                                         aτ                                  ET S         1453.5
    Basilicata                      LAD − AB                   75.2             ≈0          -54.68
                                                                                                               θ            37.0
                                                                                                           ARIM A          417.7
                                                                                                          ARF IM A        2124.9
                                                                         aπ                                  ET S          265.1
      Calabria                    OLS − AET B                  63.5             ≈0           4.13
                                                                                                               θ          1109.9
                                                                                                           ARIM A          302.1
                                                                                                          ARF IM A        1436.8
                                                                        mπ                                   ET S          333.0
       Sicilia                      SA − BET                   70.7             0.39         57.68
                                                                                                               θ           715.7
                                                                                                           ARIM A          195.2
                                                                                                          ARF IM A         983.7
                                                                        mπ                                   ET S          998.9
     Sardegna                        N G − AB                 581.9            -0.05        504.75
                                                                                                               θ          1204.6
                                                                                                           ARIM A          605.4

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                FOREASTING HIERARCHICAL TIME SERIES                                        19
                7. Conclusions and future directions. The present paper provides sufficient evidences
            that reconciliation serves the double purpose of generating coherent forecast with improved
            accuracy, under a four dimensional optimization constraint. In fact, the proposed method is
            designed to handle the increased amount of uncertainty surrounding the forecasting, as one
            carries out the prediction exercise at a progressively more disaggregated levels.
                8. Data availability. The data that support the findings of this study are openly avail-
            able in the section “COVID-19/dati-regioni/” at the https://github.com/pcm-dpc/
            COVID-19/tree/master/dati-regioni.
                9. Disclaimer. The views and opinions expressed in this article are those of the author
            and do not necessarily reflect the official policy or position of the Italian National Institute of
            Statistics.
                                                               REFERENCES
             A SSIMAKOPOULOS , V., AND N IKOLOPOULOS , K. ( 2000). The theta model: a decomposition approach to
                forecasting. International journal of forecasting International journal of forecasting 16(4), 521-530.
             ATHANASOPOULOS , G., A HMED , R. A., AND H YNDMAN , R. J. (2011). O PTIMAL COMBINATION FORE -
                CASTS FOR HIERARCHICAL TIME SERIES Computational statistics and data analysis 55(9), 2579-2589.
            ATIYA , A. F. ( 2020). Why does forecast combination work so well?. International Journal of Forecasting
                36(1), 197-200
             ATHANASOPOULOS , G., A HMED , R. A., AND H YNDMAN , R. J. (2009). H IERARCHICAL FORECASTS FOR
                AUSTRALIAN DOMESTIC TOURISM International Journal of Forecasting 25(1), 146-166.
             BARROW, D. K., AND KOURENTZES , N. (2016). D ISTRIBUTIONS OF FORECASTING ERRORS OF FORECAST
                COMBINATIONS : IMPLICATIONS FOR INVENTORY MANAGEMENT. International Journal of Production Eco-
                nomics 177, 24-33.
             BATES , J. M., AND G RANGER , C. W. (1969). T HE COMBINATION OF FORECASTS Journal of the Operational
                Research Society 20(4), 451-468.
             B OX , G. E., J ENKINS , G. M., AND R EINSEL , G. ( 1970). Time series analysis: forecasting and control
                Holden-day San Francisco 1970
             B UCKLAND , S. T., B URNHAM , K. P., AND AUGUSTIN , N. H. (1997). M ODEL SELECTION : AN INTEGRAL
                PART OF INFERENCE Biometrics 603-618.
             C HAMBERS , J. C., M ULLICK , S. K., AND S MITH , D. D. (1971). H OW TO CHOOSE THE RIGHT FORECASTING
                TECHNIQUE Harvard Business Rev. 49, 45-74.
            C HATFIELD , C. (1996). M ODEL UNCERTAINTY AND FORECAST ACCURACY Journal of Forecasting 15(7),
                495-508.
             C LEMEN , R. T. (1989). C OMBINING FORECASTS : A REVIEW AND ANNOTATED BIBLIOGRAPHY. Interna-
                tional journal of forecasting 5(4), 559-583.
             C LEMENTS , M. P., AND H ENDRY, D. F. (2002). M ODELLING METHODOLOGY AND FORECAST FAILURE
                The Econometrics Journal 5(2), 319-344.
             D I F ONZO , T., AND G IROLIMETTO , D. ( 2020). Cross-temporal forecast reconciliation: Optimal combination
                method and heuristic alternatives. arXiv preprint arXiv:2006.08570.
            FAIR , R. C., AND S HILLER , R. J. (1990). C OMPARING INFORMATION IN FORECASTS FROM ECONOMETRIC
                MODELS . The American Economic Review 375-389.
             G ARDNER J R , E. S. ( 2006). Exponential smoothing: The state of the art—Part II International journal of
                forecasting 22(4), 637-666.
             G RANGER , C. W., AND J OYEUX , R. ( 1980). An introduction to long-memory time series models and frac-
                tional differencing. Journal of time series analysis 1(1), 15-29.
             G RANGER , C. W. ( 1980). Long memory relationships and the aggregation of dynamic models Journal of
                econometrics 14(2), 227-238.
            G RANGER , C. W., AND R AMANATHAN , R. ( 1984). Improved methods of combining forecasts. Journal of
                forecasting Journal of forecasting 3(2) 197-204.
             H SIAO , C., AND WAN , S. K. ( 2014). Is there an optimal forecast combination?. Journal of Econometrics
                178, 294-309.
            H YNDMAN , R. J., A HMED , R. A., ATHANASOPOULOS , G., AND S HANG , H. L. (2011). O PTIMAL COMBI -
                NATION FORECASTS FOR HIERARCHICAL TIME SERIES Computational statistics and data analysis 55(9),
                2579-2589.

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
            20
             H YNDMAN , R. J., L EE , A. J., AND WANG , E. ( 2016). Fast computation of reconciled forecasts for hierar-
                chical and grouped time series Computational statistics and data analysis 97 16-32.
             H UBRICH , K. (2005). F ORECASTING EURO AREA INFLATION : D OES AGGREGATING FORECASTS BY HICP
                COMPONENT IMPROVE FORECAST ACCURACY ?. International Journal of Forecasting 21(1), 119-136.
             S CHWARZKOPF, A. B., T ERSINE , R. J., AND M ORRIS , J. S. (2006). T OP - DOWN AND BOTTOM - UP FORE -
                CASTING IN S&OP. International Journal of Forecasting The Journal of Business Forecasting 25(2), 14-16.
             M AKRIDAKIS , S. (1989). W HY COMBINING WORKS ?. I NTERNATIONAL J OURNAL OF F ORECASTING Inter-
                national Journal of Forecasting 5(4), 601-603.
             M ANCUSO , A. C. B., AND W ERNER , L. (2013). R EVIEW OF COMBINING FORECASTS APPROACHES . Inde-
                pendent journal of management and production 4(1), 248-277.
             M AKRIDAKIS , S., S PILIOTIS , E., AND A SSIMAKOPOULOS , V. (2020). T HE M4 C OMPETITION : 100,000
                TIME SERIES AND 61 FORECASTING METHODS . International Journal of Forecasting 36(1), 54-74.
             M AKRIDAKIS , S., AND H IBON , M. (2000). T HE M3-C OMPETITION : RESULTS , CONCLUSIONS AND IMPLI -
                CATIONS . International Journal of Forecasting 16(4), 451-476.
             M ARCELLINO , M., S TOCK , J. H., AND WATSON , M. W. (2003). M ACROECONOMIC FORECASTING IN THE
                EURO AREA : C OUNTRY SPECIFIC VERSUS AREA - WIDE INFORMATION . European Economic Review 47(1),
                1-18.
             N EWBOLD , P., AND G RANGER , C. W. ( 1974). Experience with forecasting univariate time series and the
                combination of forecasts. Journal of the Royal Statistical Society: Series A (General) 137(2), 131-146.
             PALM , F. C., AND Z ELLNER , A. ( 2016). To combine or not to combine? Issues of combining forecasts.
                Journal of Forecasting 11(8) 687-701.
             S ESSIONS , D. N., AND C HATTERJEE , S. (1989). T HE COMBINING OF FORECASTS USING RECURSIVE TECH -
                NIQUES WITH NON - STATIONARY WEIGHTS Journal of Forecasting 8(3), 239-251.
            S CHWARZKOPF, A. B., T ERSINE , R. J., AND M ORRIS , J. S. (1988). T OP - DOWN VERSUS BOTTOM - UP FORE -
                CASTING STRATEGIES . International Journal of Forecasting The International Journal Of Production Re-
                search 26(11), 1833-1843.
            S PILIOTIS , E., P ETROPOULOS , F., AND A SSIMAKOPOULOS , V. (2019). I MPROVING THE FORECASTING
                PERFORMANCE OF TEMPORAL HIERARCHIES Plos one 14(10) .
             S TOCK , J. H., AND WATSON , M. W (2001). A COMPARISON OF LINEAR AND NONLINEAR UNIVARI -
                ATE MODELS FOR FORECASTING MACROECONOMIC TIME SERIES in Hengle, R.F. and White, H. (eds.)
                Festschrift in honor of Clive Granger, 1-44.
             S TOCK , J. H., AND WATSON , M. W. (2004). C OMBINATION FORECASTS OF OUTPUT GROWTH IN A SEVEN -
                COUNTRY DATA SET. International Journal of Forecasting 23(6), 405-430.
             TAIEB , S. B., TAYLOR , J. W., AND H YNDMAN , R. J. ( 2017). Coherent probabilistic forecasts for hierarchical
                time series. In International Conference on Machine Learning. 3348–3357
             VAN E RVEN , T., AND C UGLIARI , J. ( 2015). Game-theoretically optimal reconciliation of contemporaneous
                hierarchical time series forecasts
             W ICKRAMASURIYA , S. L., ATHANASOPOULOS , G., AND H YNDMAN , R. J. ( 2019). O PTIMAL FORECAST
                RECONCILIATION FOR HIERARCHICAL AND GROUPED TIME SERIES THROUGH TRACE MINIMIZATION
                Journal of the American Statistical Association 114(526), 804-819.
             W ICKRAMASURIYA , S. L., ATHANASOPOULOS , G., AND H YNDMAN , R. J. ( 2019). Optimal forecast rec-
                onciliation for hierarchical and grouped time series through trace minimization Journal of the American
                Statistical Association 114(526), 804-819.

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                                                 FOREASTING HIERARCHICAL TIME SERIES                                                                                    21
                                                                                                    10. Appendix A.
             Fig. 5: Goodness of fit of the out-of-sample predictions (the black and red lines refer respectively to the actual
             data (the set O test ) and the related predictions. Prediction window H = 30 days
                                                         observed data                                                                                observed data
                                              3500
                                                         forecast (in−sample)                                                                         forecast (in−sample)
                                                                                                                                            100
                                              3000
                                                                                                                                            80
                        Number of positives                                                                           Number of positives
                                              2500
                                                                                                                                            60
                                              2000
                                                                                                                                            40
                                              1500
                                                     0                     5    10       15          20   25    30                                0                     5    10         15         20   25   30
                                                                                         Test set                                                                                       Test set
                                                                                     Piemonte                                                                                     Valle d’Aosta
                                                         observed data                                                                                observed data
                                                         forecast (in−sample)                                                                         forecast (in−sample)
                                                                                                                                            600
                                              9500
                                                                                                                                            500
                        Number of positives                                                                           Number of positives
                                              9000
                                                                                                                                            400
                                              8500                                                                                          300
                                                     0                     5    10       15          20   25    30                                0                     5    10         15         20   25   30
                                                                                         Test set                                                                                       Test set
                                                                                     Lombardia                                                                                      Bolzano
                                                         observed data                                                                                observed data
                                                         forecast (in−sample)                                                                         forecast (in−sample)
                                              650
                                                                                                                                            900
                                              600
                                                                                                                                            800
                                              550
                        Number of positives                                                                           Number of positives
                                              500
                                                                                                                                            700
                                              450
                                                                                                                                            600
                                              400
                                              350
                                                                                                                                            500
                                                     0                     5    10       15          20   25    30                                0                     5    10         15         20   25   30
                                                                                         Test set                                                                                       Test set
                                                                                      Trento                                                                                         Veneto

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
             22
                                                         observed data                                                                              observed data
                                                         forecast (in−sample)                                                                       forecast (in−sample)
                                              2000
                                                                                                                                         5000
                                              1800
                                              1600
                        Number of positives                                                                        Number of positives
                                                                                                                                         4500
                                              1400
                                              1200                                                                                       4000
                                              1000
                                                                                                                                         3500
                                                     0                     5      10      15        20   25   30                                0                     5    10      15         20   25   30
                                                                                         Test set                                                                                  Test set
                                                                                Friuli Venezia Giulia                                                                           Liguria
                                                         observed data                                                                              observed data
                                                         forecast (in−sample)                                                                       forecast (in−sample)
                                              4500                                                                                       8000
                                                                                                                                         7000
                        Number of positives                                                                        Number of positives
                                              4000
                                                                                                                                         6000
                                              3500
                                                                                                                                         5000
                                              3000
                                                                                                                                         4000
                                                     0                     5      10      15        20   25   30                                0                     5    10      15         20   25   30
                                                                                         Test set                                                                                  Test set
                                                                                       Emilia                                                                                   Toscana
                                                         observed data                                                                   4500       observed data
                                                         forecast (in−sample)                                                                       forecast (in−sample)
                                              1000
                                                                                                                                         4000
                                              900
                                              800
                                                                                                                                         3500
                        Number of positives                                                                        Number of positives
                                              700
                                                                                                                                         3000
                                              600
                                                                                                                                         2500
                                              500
                                              400
                                                                                                                                         2000
                                                     0                     5      10      15        20   25   30                                0                     5    10      15         20   25   30
                                                                                         Test set                                                                                  Test set
                                                                                       Umbria                                                                                   Marche

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                                                 FOREASTING HIERARCHICAL TIME SERIES                                                                              23
                                                                                                                                       1100
                                                         observed data                                                                            observed data
                                              800        forecast (in−sample)                                                                     forecast (in−sample)
                                                                                                                                       1000
                                              700
                                                                                                                                       900
                        Number of positives                                                                      Number of positives
                                              600
                                                                                                                                       800
                                                                                                                                       700
                                              500
                                                                                                                                       600
                                              400
                                                                                                                                       500
                                                     0                     5    10     15         20   25   30                                0                     5    10       15         20   25   30
                                                                                       Test set                                                                                   Test set
                                                                                     Lazio                                                                                    Abruzzo
                                                                                                                                       650        observed data
                                                         observed data
                                                         forecast (in−sample)                                                                     forecast (in−sample)
                                              400
                                                                                                                                       600
                                              350
                                                                                                                                       550
                                              300
                        Number of positives                                                                      Number of positives
                                              250                                                                                      500
                                              200
                                                                                                                                       450
                                              150
                                                                                                                                       400
                                              100
                                                                                                                                       350
                                                     0                     5    10     15         20   25   30                                0                     5    10       15         20   25   30
                                                                                       Test set                                                                                   Test set
                                                                                     Molise                                                                                   Campania
                                                         observed data                                                                            observed data
                                                         forecast (in−sample)                                                                     forecast (in−sample)
                                              8000
                                                                                                                                       250
                                              7000
                        Number of positives                                                                      Number of positives
                                                                                                                                       200
                                              6000
                                                                                                                                       150
                                              5000
                                              4000                                                                                     100
                                                     0                     5    10     15         20   25   30                                0                     5    10       15         20   25   30
                                                                                       Test set                                                                                   Test set
                                                                                     Puglia                                                                                   Basilicata

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
             24
                                                         observed data
                                                                                                                                                                                                    2400       observed data
                                                         forecast (in−sample)                                                                                                                                  forecast (in−sample)
                                              3000
                                                                                                                                                                                                    2200
                                                                                                                                                                                                    2000
                                              2500
                        Number of positives                                                                                                                                   Number of positives
                                                                                                                                                                                                    1800
                                              2000
                                                                                                                                                                                                    1600
                                                                                                                                                                                                    1400
                                              1500
                                                                                                                                                                                                    1200
                                                     0                     5                          10                     15         20          25              30                                     0                     5    10      15        20   25   30
                                                                                                                            Test set                                                                                                         Test set
                                                                                                                 Calabria                                                                                                                  Sicilia
                                                                                                                 observed data
                                                                                                      3500
                                                                                                                 forecast (in−sample)
                                                                                                      3000
                                                                                Number of positives
                                                                                                      2500
                                                                                                      2000
                                                                                                      1500
                                                                                                             0                     5         10          15              20                         25                      30
                                                                                                                                                         Test set
                                                                                                                                                  Sardegna

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                               FOREASTING HIERARCHICAL TIME SERIES                                                            25
                                                                               11. Appendix B.
             Fig. 6: Out of sample pure forecasts. The Black lines refer to the actual data (the set O) where the predictions
             for the horizon H = 3O days (the set O f ore ) are in red
                                              15000
                                                                                                                       600
                                              10000
                        Number of positives                                                      Number of positives
                                                                                                                       400
                                              5000
                                                                                                                       200
                                              0                                                                        0
                                                      0   50    100          150    200   250                                 0   50     100          150   200    250
                                                                      Days                                                                     Days
                                                                Piemonte                                                               Valle d’Aosta
                                                                                                                       1500
                                              30000
                                                                                                                       1000
                        Number of positives                                                      Number of positives
                                              20000
                                                                                                                       500
                                              10000
                                              0                                                                        0
                                                      0   50    100          150    200   250                                 0   50     100          150   200    250
                                                                      Days                                                                     Days
                                                                Lombardia                                                                 Bolzano
                                                                                                                       2000
                                              2000
                                                                                                                       1500
                                              1500
                        Number of positives                                                      Number of positives
                                                                                                                       1000
                                              1000
                                                                                                                       500
                                              500
                                              0                                                                        0
                                                      0   50    100          150    200   250                                 0   50     100          150   200    250
                                                                      Days                                                                     Days
                                                                  Trento                                                                   Veneto

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
             26
                                                                                                                         14000
                                              3500
                                                                                                                         12000
                                              3000
                                                                                                                         10000
                                              2500
                        Number of positives                                                        Number of positives
                                                                                                                         8000
                                              2000
                                                                                                                         6000
                                              1500
                                                                                                                         4000
                                              1000
                                              500                                                                        2000
                                              0                                                                          0
                                                      0   50        100          150   200   250                                 0   50   100          150   200   250
                                                                          Days                                                                  Days
                                                               Friuli Venezia Giulia                                                        Liguria
                                                                                                                         15000
                                              10000
                                              8000
                                                                                                                         10000
                        Number of positives                                                        Number of positives
                                              6000
                                              4000
                                                                                                                         5000
                                              2000
                                              0                                                                          0
                                                      0   50        100          150   200   250                                 0   50   100          150   200   250
                                                                          Days                                                                  Days
                                                                      Emilia                                                               Toscana
                                                                                                                         8000
                                              3000
                                                                                                                         6000
                        Number of positives                                                        Number of positives
                                              2000
                                                                                                                         4000
                                              1000
                                                                                                                         2000
                                              0                                                                          0
                                                      0   50        100          150   200   250                                 0   50   100          150   200   250
                                                                          Days                                                                  Days
                                                                     Umbria                                                                Marche

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
                                                               FOREASTING HIERARCHICAL TIME SERIES                                                           27
                                              1500
                                                                                                                        2500
                                                                                                                        2000
                                              1000
                        Number of positives                                                       Number of positives
                                                                                                                        1500
                                                                                                                        1000
                                              500
                                                                                                                        500
                                              0                                                                         0
                                                      0   50    100             150   200   250                                0   50   100          150   200    250
                                                                         Days                                                                 Days
                                                                      Lazio                                                             Abruzzo
                                                                                                                        1500
                                              2500
                                              2000
                                                                                                                        1000
                        Number of positives                                                       Number of positives
                                              1500
                                              1000
                                                                                                                        500
                                              500
                                              0                                                                         0
                                                      0   50    100             150   200   250                                0   50   100          150   200    250
                                                                         Days                                                                 Days
                                                                  Molise                                                                Campania
                                                                                                                        2500
                                              15000
                                                                                                                        2000
                        Number of positives
                                              10000
                                                                                                  Number of positives
                                                                                                                        1500
                                                                                                                        1000
                                              5000
                                                                                                                        500
                                              0                                                                         0
                                                      0   50    100             150   200   250                                0   50   100          150   200    250
                                                                         Days                                                                 Days
                                                                      Puglia                                                            Basilicata

medRxiv preprint doi: https://doi.org/10.1101/2020.10.11.20210799.this version posted October 13, 2020. The copyright holder for this preprint
  (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
                                        It is made available under a CC-BY-NC 4.0 International license .
             28
                                              6000
                                                                                                                   3000
                                              5000
                                              4000
                        Number of positives                                                  Number of positives
                                                                                                                   2000
                                              3000
                                              2000
                                                                                                                   1000
                                              1000
                                              0                                                                    0
                                                     0   50   100          150   200   250                                  0   50   100             150   200   250
                                                                    Days                                                                      Days
                                                              Calabria                                                                     Sicilia
                                                                                                                   120000
                                              6000
                                                                                                                   100000
                                              5000
                                                                                                                   80000
                                              4000
                        Number of positives                                                  Number of positives
                                                                                                                   60000
                                              3000
                                                                                                                   40000
                                              2000
                                              1000                                                                 20000
                                              0                                                                    0
                                                     0   50   100          150   200   250                                  0   50   100             150   200   250
                                                                    Days                                                                      Days
                                                              Sardegna                                                                     Italy
